#include "ProcessList.au3"
#include "Settings.au3"

Global Const $GUI_EXIT  	= 0
Global Const $GUI_RETURN 	= 1
Global Const $GUI_RESET 	= 2
Global Const $GUI_INJECT	= 3
Global Const $GUI_UPDATE	= 4

$h_GUI 				= 0
$h_P_Banner 		= 0
$h_G_Settings 		= 0
$h_L_ProcName 		= 0
$h_I_ProcName 		= 0
$h_L_PID 			= 0
$h_I_PID 			= 0
$h_I_PID 			= 0
$h_R_ProcName 		= 0
$h_R_PID 			= 0
$h_P_ProcIcon		= 0
$h_B_SelProcess		= 0
$h_G_InjDelay 		= 0
$h_I_InjDelay 		= 0
$h_C_CloseAI 		= 0
$h_C_AutoI 			= 0
$h_G_Method 		= 0
$h_R_LoadLib 		= 0
$h_R_LdrDll 		= 0
$h_R_MMap 			= 0
$h_C_LaunchMethod	= 0
$h_C_HTFD			= 0
$h_G_PostInj 		= 0
$h_C_Header 		= 0
$h_C_Shift			= 0
$h_C_Unlink 		= 0
$h_C_Clean			= 0
$h_B_Reset 			= 0
$h_G_DllList 		= 0
$h_L_Dlls 			= 0
$h_B_Add 			= 0
$h_B_Inject 		= 0
$h_B_Remove 		= 0
$h_G_Info 			= 0
$h_L_Version 		= 0
$h_B_Help 			= 0
$h_B_Changelog 		= 0
$h_B_Broihon 		= 0

$l_GUIWidth 	= 800
$l_GUIHeight	= 425
$l_BannerHeight = 66

$l_WindowTitle 	= "Guided Hacking - Injector"

$l_bBanner = Binary( _
		"0xFFD8FFE000104A46494600010101004800480000FFFE00134372656174656420776974682047494D50FFDB0043000302020302020303030304030304050805050404050A070706080C0A0C0C0B0A0B0B0D0E12100D0E110E0B0B1016101113141515150C0F171816141812141514FFDB00430103040405040509050509140D0B0D1414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414FFC20011080042032003011100021101031101FFC4001B00010002030101000000000000000000000004050103060207FFC40014010100000000000000000000000000000000FFDA000C03010002100310000001F8A1AC03D1B0D200000000320C000C806019060000000006C358001ECB12B8F00000006C35800000C962443400003D1B0D20006D3C9E00064C000C9836035992C4D46A241E4825815E002C0AF271E8C007A2B8DA5911C1A0D05C9101E8846B3A639900E88A43403E8871A568075C6A2ACB33D1CB9D21CC82D4B63943A6324D38B001D31CC9D1128A92713CE48D20C9626A351BCD644251B8D07A3710CD47A2E0A500986D2B8D80D65915A0024182515C002C4AE27820007A27110DA4500C930840164569D39CC00748511A09C59134E481D59CE11C03264E94E60E84C9CE83A83C1089673801D3908C14C0193A739705915A0006D24108005895C4D3615C013C100D80F04E2000002C4AE001625713C100004F229B88A0C19261080369B4ECCA400BF385341D69C91D39CF1A4EACE50000F474A4C288A900EA0F050170682A01D39B0E500000324D2080013C800006D369B48649219E8967A201B01E496420483683C1BCAE001625713C100004E23160470683513084019261D01CD807447366B3E9273664B03863A93960003D1F513903073801D41E0A0349D5140443A73D9CA8379D00361CB992410C0009E4000004E32402C0AF279009E4036035960578001620AE001625713C100004F229B48A01926108026118E90E6003A4288E90E5CF00EB4E48EB8E44000F474A7305C134E681D41E0A03483B438D3A5369CA18001D69C9982C4AE00026914F000261189840269149A57928D4601AC960880164403D1B8880C9605713C1000271A4F06D228064984204837104E9CE6003A4288E98E480249765716A72E017C519D29CC02D4B33973A83C1406907B3AF221CE1D91C51805C924E7412CC114025114B42B4F20DC482192C840B72011C13C880D60906F30648479048379804106F3D1B819221A8F4589AC1A0D0599A81A88A0B42AC02C8D26484002D8A92717C793D140432CCAB00B423124C15E78009A5A1CF1B0EA4D67A2B0A725822120DE60F4413C82798326B221B8D67905895C0120D60D60000000000000000000000000000000000000000000000000000000000000000000000000D87FFC4002F100001030203060603010101010000000003010204000510203306111213143422232431323515162130254060FFDA000801010001050226A628D57572489FEBBB3EEADDFF0085A373F3318E22FE2A6EE7B1C35FF1631C477F87BD32DB2C8850100B99AD575724899904F75398E665F6CBED80F509A9489BD78071A9D30AB4920A95D62BE8A04E0A849BDD9009E96A5FCE0AF09BAF915D71EBAB575721864A16A489A769FAF915D7C8A2C821A93DE54C332475F22BAD25272645106E13AAEC9BA163B3A9BEF86D6C2CF20765837186B6F9B88EDD1EDC126D14ADDF959BC4CDA294A87811A681BEFB489BAF385BEDA5B91664F8F163D5CD375B7665786FF75032E43C97F4DD26A05ADA50BAFBD353EEF388A1DA29E2468A15EE8C17C72E088AE5E11C5A74C2AD2482A5756AFA28511B410736BA868A96495D4D9666D710A45106E13A9A9C4EB8EE22E31588E34F5E39143D426A50FD303200CA0799188485F2C80ED6A67CE1EA62D72B54FB8A316ACAEE714F79BDDE2C5EA45576EC71D9CFBD3EB5428AE9D2EF929B2674EFFA168C2CE21C60C8904946C8DF96D2FDD55BED5D48EE175E78B0BA7D66CD7DEC69C4B74FBAC11B1B8ED0773698293E65D2E2B703E49930573B760CF4C0CA21A9492488AB907EA4550D3D4C75E6E44F2A21BC51E87A84D4A9ABE76685F2C80ED6A67CE1EA648BE2A16A4AEE7756EC13DE6F77889FCB24967048996A993ADBFAEDCEBF5DB9D7EBB73AB0D8AE00BC1F5AAD9E82DD5612B564184E016AEDE45BF2B7E5B4BF7516CC9121DC2E45B8931BA7D66CD7DE9B5AD570488EB9DBD6DE7C3683B98DE9B67B3A26F598BE7E58DE06651BF96492CE0911FC2363D46F94C469A9ADE274B779ACF143A1EA1351BFC74DEEB0185489D23ABA4751233C6C85F2C80ED6A67CE1EA6487AC2D4932CC923AC357586A215E5A4F79BDDE499DCDD0AF640EA4B5D496BA92D6CE9C8B7C3EB318A47DE2CB2387F5C9749B3D311769E1BDAEABF7F572B7E57B5896AB9C7BEC86CAB8DB1A21E374FACD9AFBD36B55B250E482545242915B41DCAF8B66300056417F5E915FAF48A66CD4B2BDCD56398BB9F33BACA2ED734D5DF27E30AB562544F0AD44FEAD0F509A9523CC1E591E5060EA640FF21D4CF9C3D4C8CF2A30B5257738A7BCDEEF18ACE22BDDC6FBB7638ECE7DE9F5AC2C40BDEF523F0B3FAD8B4A9F91B0656FCB697EEAADB727DB8B71B68D0585D3EB366BEF4DAD84754BF447355ABB41DCD93D585515AB92C4DE953DF093E6332C572731EC51BF24567115EEE37C9F08EA23910AE6AB1C5F2A35457F0482B78083D426A500DCBA34751641B123239CAF7088A22481703B044E2591E50AA67CE1EA6228FE13179AE16ACAEE714F79BDDE0103CEA5235ACABB7638" & _
		"ECE7DE9F5AE7E82DB8C690E8922FB1D8C996E9EFB7499F6B6B8588ED2FE89BEFB4BF7585BAE24B71AE16D1B81574FACD9AFBD36B60D72B1D29897C8BB41DC8C8E13CE06ED031515AB85BAD65B82DD278CADC005465180A2C84028875DEB5CD56AE02138CE311AC635389662EF9383C5D4964139A6C26EB8F509A9808EF0D7300FAF4D5D4B474E72B970199C3AE28EEAF4C95D4A3312939AB1CA81271C6AE38F5D4B19442B8AEA6AF0B9E68E47F1C7AE38F4570D7021C057F1C6AE705B4592F2A612E6F540C6DD2FA09C2335B2E6CA74E9791F3B996DA8934F00AB738332B759692E7061D4B9A79E54FE2DCA6FE426E36FB816DA794F11644A9BD4C6B6CCFC7CF7BB8DF8C39648126F9711DD26D308E13FF0038C969FF0015D5D55A6354EBAC89E9514831499441964D08EF0D7300FAF4D5D4A0E9555CB8757C49E996B8A3368925C46D09FCB2B9789D806572A3E242F31A3D426A7FF443D4FFC40014110100000000000000000000000000000090FFDA0008010301013F01613FFFC40014110100000000000000000000000000000090FFDA0008010201013F01613FFFC40047100001020205060A08040502070000000001020300110410122131132032415171052223335261727391B11442628192A1B2D1435374C124303463E194A2155054606482F0FFDA0008010100063F0256FCCB84F74736AF0FF931B292A909996ACE92525476089FA23F2EECC4949293B0FF002825092A51C00FE54D3457943686CC49C6D4D9F684B3EE04EE8D0578675C851F74719246F1FCC4EF856FAA4318E3F28E743508B95606C45D1CE2BC624F243A3E7E319468DA6FE69A9DEECE6D27DDE7523B020918849F28E74C73A6394421C1BA51364DFF009671A93BE1C01C2005473AA8E7551C759554B4A5C20038473A638D25F6847E42FF00DA60A54246AE0BEE0FD4732840DFCA0873B46B43AF242BD3959320FE56BFFEEA875837D8371DA356625FE11B456A1345111728F5AB608B146B3416BA14712F9E316BD2DF9EDCA18B149B34E6BA34813F9E30BA4500949409B94670DE9EB07588114895D8795652DC9284DEB71572503AE1543A009A1573B4850E339BB60AB82BBB57D462827FB821CA7D19212B49FE2194FABED0EACDA3CBFE9DBF2A8D2A94E7A3D0C195AF59676262C707308A227F32569C3EF89AA96F93DE18929F2FA3A0FF001C7CE24CA45029BA9B9F24E6ED90A6DC4942D264526B90BCC71C655DE8EA1172AC0D88BA2E715E3127921D1B75C5B6D5691F315124D940C54624CA25EDAAF317B8AF18E709EA37C494034BE90C22CA848D406D80E2757267DD9809D14F18C15F4C5AA93BE15BEACA7E22EE4F575E6CC5E358DB06C19A3543BDDAB3693B879D48EC2615D857966022E2203C2E382C75C237C3BDA39821CDF99933A69BD07F6AB82BB83F51CCA177821CED1A9A611A4B54A0A5AE6191926F708A352F1758E41DDDEA9ADDE117D36D0CF15A41F5DCFF0010B75D515B8B3324E688A47BBCAA348A42FD1E849C5D3AFA93B4C0A35191E8F424E0DEB575AB6D7C15DD2BEA3142EF214EB77DE42927050D86114BA2DF43770FEDABA27328FF00A66FE980959B0CA45B715B12226058611C569B182539A871D54A9ECF127F9A9FB8AF29F88BD1EA1B739281898C9A39B461D7D79B933A69BD07F6A92750E343AD9F5EF1BF309D6E197BA1856C9A6A4EF856FAACEA40B39EEF76ACDA4EE1E7523B09857615E59AE23A49846F877B4730439BF312A1A8C2C0C271C16BA3D19C7921922684CFD631FD03FF00047F40FF00C11FD03FF04511C7286F21095CCA8A70873B46AA553CE9AB906779C4F854BA23A64CD293933D47D53E30B6D624B419115706D186193CB2B7ABFC6708A47BBCA0708708A1628F3E4DA18B87F6100AE496D3721A4E8A07566705774AFA8C50BBC85F68C2DA7D394A1BD7388FDC75C4AD651958B4DB830526BA3FE99BFA6294E0D27DD4B33EA179FDBF9253A91C5CE797AC2643DF9C950D4616061387D7ECCBC6028622263455C6150031316068A05910E0E8A81A93BE15BE043BBEBB8A46F54A349BF8C46937F188B46C94CE5719C3BDDAB3693B879D48EC2615D857966CF624F94237C38328748C738A8E7151C7515408737E6AE3828256A4F20703ED18E757F1473ABF8A39D5FC514205C591941EB439DA301291351320228D44654C64A8E8919BE81359D2D71A547FF508FBC4C2A8F3FD423EF147A62AC4DF4C9CB0A0A16C63855415EA551519C21DA42ECD2E98A91435EAB7762AFB438E3E7D250F5CEB6BC142052E88A2ED097AF5A0F45599C15DD2BEA3142EF217DA357FC3A96A934A3369D3F84AFB42D97536569C6AA3FE99BFA6132F529467EF4D696D2520ABA464239EA2FF00A847DE39EA2FFA847DE0250BA32947002909829388BA127AE1DED673E371CF5476D7E557B4D1F954B77A02EDF5388E920D49DF0ADF536F7FEAADF9CDB3AF4950B1B50A19B483B6C8A91D84C2BB0AF2CD5AF5AF8A3F7846F877B4730439BF32D1D04718C151C4DF1C15DC1FA8E650BBC10E768C3D4F58E251536875AFD58529466A519935D2B838E2B1956BB63EE2A4917BD423223FB67FCE708A47BBCAA2400E34BB9C695A2B11E994225CA1AB10749A3B0D7C15DD2BEA3142EF217DA358A32CFF001ED0E4567F113D18208911AA28FF00A66FE98A5F079C5F4DA6FB620837119B48E115E8D1D32475ACE15B6F0D62CAB7E759568AC59829388CDB47411C630A51D77C328D899F8D564E8AF8A60A4E221B6F5AB8E7F6A9B3D70A4EC309DF0ADF514A84DB56222D0E3367050CCCA39A5EAA20A8DE4C2563545A4F36ABC1AE42F3096358E32B7D" & _
		"48EC2615D857966651CE235E7BA309245C06C846F877B4730439BEBE28BB59D42324DDE9D6AE955C15DC1FA8E650BBC10E768C5168034D5CBBDBCE03C331B79172D0AB4203ED0E42929CAA3AA788F180EA45A182907050D623D328337688714FACD751FBE62A94FABD1DA97276B170F5081148F7795769125A1572DB568AC6C31E9B419AA8A74D074993B0FDEAE0AEE95F518A17790BED1AC29264A17822154C6C4A98D0FE21B1EB8E98FDE28FFA66FE984AD06CA9266088349A30029C072D471EBFB49FB448891D9593734C234DE5E8A61BA2D1414D0D9D19E2B3D23594AEF6D58889E920E0A1980ACC947046BA86A7C7FBA24448D7248FF11926EF1EB2B6C01B617B05D5B2BD4E697EF0A56AD55DAE980A84EF856FAF8A6E3883818E334507D831F8A7C23926C24F495798993335CB149C52708BD0B4764CE3F14F847248C9FB589AC194A4008991684A528E657F1C734BF8E39365293B557C4D6A2A3503B20A8B2B99BF4E3995FC71CCAFE381610A4EF54EA2A534B99F6E39A5FC71C5627DB54E244C93D14DC2BA2B766CE411627B6F9E63348B36F26AB5284BAB45B45BB451B61D7D7A4B54F35BA2A9132DACA90BD80E22ACA30E16D5D5AE274BA059735B945558F9611A74EDD65313A1D02D39F994A55BF9611947DC2E2FAEA71FB362DEACCCA377837290AC1436185A996F24D937227394511AB32C824A67B6F9C3348B36F26A9D9852B699E621E68C969F9C079A6B229C9A536364854168514A860444B842888A51FCE49B0E78EB89CE9CDF5492A89B5437A92AFF00C87249F01012B210D2745A6C5940F754DADD6F2AD03C644E538716D37926899A5139CAAE29BB5A4E11C66CA3B063F14F84722D841E91BCC4C999AE4EA43A369C7C63F153E062E42D7DA328B37211D14D4954A72338276D6E372993A2766DCC6C4AF4894277C2B7FF00DC69DF1FFFC400291000010203070501010101000000000000010011213151102041617181A191B1D1E1F0C1F13060FFDA0008010100013F21E4AE19631501D111C846B52FF4750A634BAC6853A853A853358C68531A1FF167B94B851D95BD92735CAE427AD641C563690D7E1B440DC94605B1BB2B4024C039A059B7D01D964E70FDD7CBB1DC8E888E4635A95D1CE22A0976432E904A21AE9049886230B3825C9584101CA0004647963D538A81E47378445C0CEB4350790C2914B8CFC9E6C0380FE1BA02468816420341BC68A44C4C1B024F32A96CC4F75089339B13D91C6CE1FBA2B580006B68003004093A91AA6FC700616082C08741941080A317F0260B385812C0009733B98040018057D8ADA65214248607B9285BE47702DC35C8CAAB18E04F721CA8C73DE7755FA547742F563DED2BAA88DD1417C89AE5200E001E11A6D14001CF3025D8550C5844500012FE6A30098322FD78C61E555C1BA06C023C34D852F221E8AC4E72099B1707066C9CB6659CFA3E455252207D922F2E60A119F29262799588368C0092000465ACCF5EAA0FB2DE11170CEB43500203BA0778968CDA1B08C4CBE1ED18259177C29DBDEA42155672846B729BD46088D91CD85173264DA000703A38B9F9232130A180A1CC59C12E4ACDC4C96293B930C40F20A288711C992FAD4BFD7CAA5D408D98804200982161CB75C0F75F02B739D749EA28F3031BEB66F915B25CC9F4A9527C83DB7DCB9DD433215CCDD271B5A1184091924F94C5546E063701694172172FB764716B0913A488B3C7018B5B15C2DC226CAAA36639053AD9B019E27E55173E4D09F4ADAFC7C6EA03770A52DEB70162E2050419808847049F86B4F598E55E4C4564150616663746E461E60636044AC52D83AAB41B58DCD099A7DACDA05D8FBB3825C9201CB5548E5036BFF5A97FAF954BC84EE453B8885C6F740641F62750A750A92E75D224CC02852B20D11445430015FF0074BFBA5FDD2051295800BE456CC2816C50B4EEB22EC28CBF1189DE9276045852D3B9C6F017B90B97DB457A181B611CF263826B45656A00BA5B845F52A8BD00FCF9441C21887291F36FC9A11CBC3192FF0008C0063050A480234BC5E45105E3CFC22855B0345A519DCA70CB846527D9361232230423E0A27CACD9D661E2CE0972489CD0841BC66D2E2C14AD20838A980712FAD4BFD7CAA5E402290127A971BDD01410203E6BFBCBFBC8A824049D73AE900E40529461C20E024182FF00AA5FD52FEA9170870125F22A893010189454C900441106A86D62E0A0405C10B3A321DC4288888C0EF6031E1BB383C8BDC855079F846A85263ECFE9360D246B08C0BC60E78DD2DC22FA95B09BE1C8CD8A7A3360FD1959F2685F6900DD8DA4B0CC08F78995AB16186FB1693CA9E624993D980140DAC378DF15FB5E112B49B0E175B803DD8619A0DFEEC07993FA9009DCB99AD153711FCB3825C9582D988D20F5783D562643A28B1A33A5DC9041EAF67CAA5E405F21D3F12E17BAF815B9CEBA42CC474459D1257AD9BE4553DA9B271601D63B27B241189369679CE019750221A066A794F144AE0EDDD7B90B97DBB03A0A77427CA01341BE07C0E370B708BEA56D08E193963CC61D111B1CC4A60AF9342619308FEB81B87086412188385D10C31AFE1D806913B224912624D81F9A80F57847CC411A3CB9409D8EC45D1E723A22CE0653713D49ECC33A77943708C6D069CD9341D13BD8C1704B92B044D5DBF619A0009A4C7C1B8103A8F3399C91D974E4A98C1BA04CBD2AD20004900022028B91D1C36B3E552EA0EB96B133CA87198233C0B81EEBE056E73AE1100809B0D429E5C47ACF17ED9BE45561A0B688DA775C24AC44CC269108D7C01C101F3067AE62383C5E7168D297030FE19D3D2CD729" & _
		"72FB76970804FF001204E6CB34576252D16E117D4ADA7F06E200A152820D83E62BE4D088C424C8109F06880FD59A1C900812111680E6250C1D713927BB2750E61E05ACBA5C5866334CE274D8DC0A4DB0A9A58180700B07C3E5119C29836C5DAA70D49C3C57ABF08A1264C99028F685924D24031508F853350730506163B1740ECCBAA05C12E4AD3A7204FA814FE3430FA14C38E5302EAB47A9119C499368D20D2C5C962EF2C3950B1690220902741C7970B7C6C2A707291016985F4FC23F7FF10DCB227CC16B682CC7773A7C61737A2FB7E17DBF081BA71F5102C415366A2DE8BEBF84312AA4EC640E20642E0B718A623CD773730FCA2B3A6BFD12663BB3A9B1A314A0BB376F190EE46C1197E4C81423108D45557664C1E8651DE0FD5DFF001410024FC33020753A313F41CA428060113068A97C9DD980171F2801B9F1E0A239F7E3ED5D662E8C65FA5AE6133A800CE32E3F1EEC1883915A5791260B6561843B96C414CC11872A086E088FB0AC5C2106BC88BA1C7AAECAFA421DEC695599268E9E5572268F63C4439072D93B72F8987D0A871C860437E8FF009A3B289326D0431D40401433D8B444C93C80E137228F61BD6C19B6611148CC9ED7DB9B7E172521DCD62B825C97FD1F04BFFFDA000C03010002000300000010924924924924900124004804924924920924924924924824924904924924924924924124824920820904924120820924820924924120124004804904824900924124924124004024924024904920104924004804124924824920100920924004024124900024824924924924924124824804924904924004900004924800920124000924800124124900924924924920124800924824924824904924004900800924820000120000924820124124900124920124920924920824904824800004904004924124924924920020020924804124124800924020824920924920900904920920124904004824124924824920124904820804924124820924904824924024900924904924920900824124124124020920920924924004804904024920804820120804824900900904924924924924924924924924924924924924924924924924924924924924924924924924924FFFC40014110100000000000000000000000000000090FFDA0008010301013F10613FFFC40014110100000000000000000000000000000090FFDA0008010201013F10613FFFC40029100100010204060301010101010000000001110021314151611020718191F0A1B1C1F1D130E160FFDA0008010100013F10F65ABC9BD6E0BE29E005D503EA914890993FF30960BBB57F0292C578A9E4FE457F02BF814AC4275387F22BF914D9BDB91101441B939F209002AE01C84B2995E0E2A30092FCC1D1304B762BBBEC0514836292ECF1448889889C80B302C12C181C1101441C14C697C1C817A018D05108184711E5455C4B4DF8914258095A1EC448A9DCA6FDDBBE01CFB05045F14F0231583EA914890993CBB8CA63EAA2AE3A9F6E58C3281848E572E442884E1ECB52BD96AF07C2D809574A8F0F1581B458B63CD09B3003EB5ADE2B1FE9440E164DBE05FCCD0DCA704C3391D3659E10190724986861C8C00C1A973805404B6338D41E37B2450D11FEE7F941C05A30FE51170618BB31B473A2AF20CDCAED8D60C3674A126DCFC5514B24A0050615FDE3FCAFEF1FE52985911B357F4DF756169940416C294FF73FCA0A55C66FDE27E69488BA8AD2F7F994AC5B759EE399BF04B632085633C8704A42471CA8800407D8E215A87ADA59C1B26914C28F07B1D9177E38D3CA1A523D44C8891A56433C38BBCBBB4DF4CE6DD69964D123ED2EE512EB8E8F8D945998339ABBA6FBA1EA60080E2D98C3F2E2DB06862E0540F601651981CE2C1771783C119042B335A8438C4937268B705D02A0D478FD0F23850C0AB0112B33C22F4E18C62BEE2DCA9DB266C99D96C4159CCAC06936BEC61E88B1DA2B58F73DD84BE4956A5200E441B1138A1F1829574A86331883E8CBAD8B507372801ED0F9ADE631FE942981A89D21BF99ABD13044D23FA59E18D8A780066B42A751168BB806DD9E6989DA603C55A332C84DC91496419C3FBA4F158E716320C91CC75E17C809EEC504D884188856D7E9C80EC8B3618B1DD83BD08E05180424F33C3D96A57B2D5E0C08DE93976EA6477A552AAAB2AE7C83080670F1451A3C46710932DCC3B7040C393D0E8E1EBB4D7B6D5461C508B0942351AD2E4042C4D3ED35EC7457BED5C9F01F75EDEC723AA954E2175D6D739B17B0DEBD46AE02CD9590ADCD8257A52B107AC22F248D16280AC80A7ADCEDE256E6092248CC88B60CE9FA31A953E8D0CB9125264430C5ABE0FEF8F160EBD28DDC9B58C568902EEA2F76E98191C983D2E8D42D61D4B00D985BE69437D32719BD33687170E0D1778779094DDC1B8A2A0C35B0006AC562ABC88488322308D3161D92C4606442B8A34E2622D33CC6C1BAD8EF4AAAACADD5E587882170355D8296C651790DD7E39718E2EC42FE1B9D3862AAF40DF8A62895CBB83C9277AEB678E98DF98AF9878A79A5C0DC3E383D96A57B2D5A4218A82806F67F485FE67FE0818727A1D1C3D769AF6DAA8C393677874E6F87CD7A9D15F082DD5FC0AFE0523884EA57C07DD7B7B1C8BC4784B517D2526AB9F0D4D9DA4028533BD7B9FE57B9FE57B9FE50C99C2499562C57A8D5C33D21DC6EBC6A753C08CA29DDB3D92ED16905621852279384EDB026630BD07CDF07F7C38850734589D57AAF4744BC5B7EEADD6EF2E0F4BA35EF3550CC519B8784B71EA6743F15B3A1A26032478387068A192431981DDBBA7FC131B2077A3C3B" & _
		"484087E65E68158936897789A395A2823D9A0920B1DD73E1A59426DB81F5348EC05B71A21E05E623B3276E01BC1119AB141164CD92E2779562990A4E005707B2D4AF65AB46EE0A7CD20C910B3A373EF896794235E16BDEBF6BDEBF680C40B3C898B3B7040C393D0E8E1EBB4D7B6D5461C9792239D28F53A2869D00C04B8B1806461398AF80FBAF6F639108BAA055B3866A9A807EA91DB642AE340D7ADFED7ADFED7ADFED062096897B22D7A8D544A948951803BB515975B69544485E61C204FE6A4012E351680A13E6240D99CD4D3B819A984917939BE0FEE9620303DF7BCC184E948945726540CF990B2D51513B5FDE03032C030E5C1E9746BDE6AE07698BB2F82BD3065672A774FB70744CD108988D3870699F1624CAE8F1A0281B97740375E33264E9D86FD009AD122052A49186F9E1458114EC94F344914E8B27DF3452489BA087ECE60805D58288310973708FD536CD4F5FF4706B692D727C7DB8011BE933B4F967B52912532AEB57CE02138D8D0C2BD96A57B2D5E0B7DC30E4E05EB07B3C62A2A36A99AC64F4649D01E6946922139CD3EA8C392E42E44E72FA1C3D769AF6DAA8C39348E3CD90F42C1DEBDCE8AF7DAB93E03EEBDBD8E4396C6661180EEC14FB4F521679717B0DEBD46AA0ED12B6EF4C786AA5AE8C512AF76A2A28900EF5329FE80522410308E4D60046AF023B4C3A079BE0FEF8F1821FFA4310C9D05C6E50B8FDC959665D91BF260F4BA35EF35717D021108257CCAEDC7B293F00D80591327834270952B5DEADBAC9481C87428611E3151529C9964A6B88574A294A255CDE18D0020C9C5FAC1F3CCDC0F36198ED0A744CBB24E509642561180EAB077AC78A9DD9AD16C04E63E91C244C4D38191ECC3440C993A8C55B564DF86C3C4BDF80348370CD67E1A5C7DE15AF65A95ECB5783EE88F89A6D28A5FE743F43C71633A196C733323C8699D34B49F9AD5F54B1D4CCEF443170B02717A261C5EF8C14AB4229D524990763E5787AED35EDB55187153564286D0CDDF028D20EC18703AEAD7B1D15EFB5727C07DD7B7B1C6C92657035C028EAC6CF08FD0C8EFCD8BD86F5EA3556506098FD6DB1ABE46AE156A4F8A27853C1F665DA29697B9C5C0F44F0C34928A05D7135E1D04DF9241F00572168BAB09BD7C3FDF27167973A4BFF0001C46E53723D094F2BE82637E383D2E8D7BCD5C4F3E52813223923407E2C1436099E0033DDC1A35CE3216911EB563E6B130B8E6712B8DCA41CEA210C4470E3DD2C1FABE009569D45D8C3EC7D8B1A0719D90188230DA51855DDD968E8EA3C4150095C0296028A1EA309E1299AB380B0274E1BD26A381C23D38E18025EC5AAC0286C56CD11E11B32F34074809BAC5131942FCD89F8E02A1184B8D60EC742DD3D8F2A0352EC4D8780E0220C232344F8017709F99AF65A95ECB578C13B68626E59A53237FE1763CD125749F612FD5763A88F4901D8A490F2B95789ACE4F561193B945F29C490EC09F9A04339480BDEF50074A929B2FA052AAAB2B75783BD819333089A7D353DD10B30EB5FC8561DA6DC56E863013DC3F0AC9D98BC0D0323A70B31631D619A94D0C084ACB5FE62BFCC5438C37004F08ACC8846A42AECE13B15FE52AB284B6087612A5CED200F663D5E3E47156C916CB1B724FD1689394E54F0862E755ACF0C29F4B606C56C6C101D39755206E18C5C402F6675E0240923B85593444A441CE01EE6A8EFE717D3F7A3266532E849E8A01E885B650AC1A005590990C54430A73DF241A720C66651DB22BE312B0C27253888124CC6D59EADDFC591168B2B02F2D2B3698631ADF461312AC725D9F84928B0F30911C46A149C332303AD86DC0B971E9D8225C6A17D8928762A6ECEF5081EDD8A363F2D29896393B89E86AC70EDFE085DD2EFC2F43B6436F06135723D925B69318E0A90C0975AAD4C83B813E2B1E6825767F612FD50E9B191D148EC29C63CAE55DDE02888C25C4A29B72283617F33483106140EF6A2387E53BDC0AF9A82E8C923FB2EABC1B7048B1317C6B115AE7559E20D19BB63CACA2DC49A482598C93C4C57B2D4AF65ABFF00D1FB2D4AFFD9" _
	)

$l_BannerPath 		= @TempDir & "\GH Banner.jpg"
$l_HoverBanner 		= False
$l_HoverBannerPrev	= False

$l_HoverProcIcon 		= False
$l_HoverProcIconPrev 	= False
$g_ExePath				= "No process selected."

Global $DropFileBuffer 			= 0
Global $g_DllList_SortSense[4] 	= [False, False, False, False]
$l_IgnoreInputChange 			= False
$l_ProcIconIndex				= 0
$l_DoubleClickedDll				= -1
$l_UpdateProcess				= True
$l_ProcessDead					= False
$l_ProcessPickerActive			= False

Func CreateGUI()

	FileDelete($l_BannerPath)
	FileWrite($l_BannerPath, $l_bBanner)

	$h_GUI = GUICreate($l_WindowTitle, $l_GUIWidth, $l_GUIHeight, 100, 100, Default, $WS_EX_ACCEPTFILES)

	$h_P_Banner = GUICtrlCreatePic($l_BannerPath, 0, 0, $l_GUIWidth, $l_BannerHeight)
		GUICtrlSetCursor($h_P_Banner, 0)

	$h_G_Settings = GUICtrlCreateGroup("Settings", 10, 80, $l_GUIWidth / 3 - 15, $l_GUIHeight - 95, $SS_SUNKEN)
		GUICtrlSetFont($h_G_Settings, 11, 700)

		$h_L_ProcName = GUICtrlCreateLabel("Process:", 20, 105, 45, 20)
		$h_I_ProcName = GUICtrlCreateInput($g_Processname, 85, 102, $l_GUIWidth / 3 - 100, 20)

		$h_L_PID = GUICtrlCreateLabel("PID:", 20, 135, 25, 20)
		$h_I_PID = GUICtrlCreateInput($g_PID, 85, 132, 40, 20, $ES_NUMBER)

		GUIStartGroup()
			$h_R_ProcName 	= GUICtrlCreateRadio("", 65, 102, 15, 20)
			$h_R_PID 		= GUICtrlCreateRadio("", 65, 132, 15, 20)

		If ($g_ProcessByName) Then
			GUICtrlSetState($h_R_ProcName, $GUI_CHECKED)
			GUICtrlSetState($h_I_PID, $GUI_DISABLE)
		Else
			GUICtrlSetState($h_R_PID, $GUI_CHECKED)
			GUICtrlSetState($h_I_ProcName, $GUI_DISABLE)
		EndIf

		$h_P_ProcIcon = _GUIImageList_Create(21, 20, 5, 1)
		_GUIImageList_AddIcon($h_P_ProcIcon, @SystemDir & "\shell32.dll", 131)
		_GUIImageList_AddIcon($h_P_ProcIcon, @SystemDir & "\imageres.dll", 11)

		$h_B_SelProcess = GUICtrlCreateButton("Select process", 155, 131, $l_GUIWidth / 3 - 170, 22)

		$h_G_InjDelay = GUICtrlCreateLabel("Delay:", 20, 165, 35, 20)
		$h_I_InjDelay = GUICtrlCreateInput($g_InjectionDelay, 65, 162, $l_GUIWidth / 3 - 80, 20, $ES_NUMBER)

		$h_C_CloseAI 	= GUICtrlCreateCheckbox("Close after injection", 68, 185)
		If ($g_CloseAfterInjection) Then
			GUICtrlSetState($h_C_CloseAI, $GUI_CHECKED)
		EndIf

		$h_C_AutoI 		= GUICtrlCreateCheckbox("Auto", 185, 185)
		If ($g_AutoInjection) Then
			GUICtrlSetState($h_C_AutoI, $GUI_CHECKED)
		EndIf

		$h_G_Method = GUICtrlCreateGroup("Injection method", 15, 215, $l_GUIWidth / 3 - 25, 75, $SS_SUNKEN)
			GUICtrlSetFont($h_G_Method, 9, $FW_BOLD)

			GUIStartGroup()
				$h_R_LoadLib 	= GUICtrlCreateRadio("LoadLibraryA", 20, 235)
				$h_R_LdrDll 	= GUICtrlCreateRadio("LdrLoadDll", 102, 235)
				$h_R_MMap 		= GUICtrlCreateRadio("Manual Map", 175, 235)
				If NOT ($g_InjectionMethod) Then
					GUICtrlSetState($h_R_LoadLib, $GUI_CHECKED)
				ElseIf ($g_InjectionMethod = 1) Then
					GUICtrlSetState($h_R_LdrDll, $GUI_CHECKED)
				ElseIf ($g_InjectionMethod = 2) Then
					GUICtrlSetState($h_R_MMap, $GUI_CHECKED)
				EndIf

				$h_C_LaunchMethod = GUICtrlCreateCombo("", 20, 260, 121, -1, $CBS_DROPDOWNLIST)
					GUICtrlSetData($h_C_LaunchMethod, "NtCreateThreadEx|Thread Hijacking|SetWindowsHookEx|QueueUserAPC", "NtCreateThreadEx")
					_GUICtrlComboBox_SetCurSel($h_C_LaunchMethod, $g_LaunchMethod)
				$h_C_HTFD = GUICtrlCreateCheckbox("Hide from debugger", 144, 260, 110)
				If ($g_LaunchMethod <> 0) Then
					GuICtrlSetState($h_C_HTFD, $GUI_DISABLE)
				ElseIf (BitAND($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)) Then
					GUICtrlSetState($h_C_HTFD, $GUI_CHECKED)
				EndIf

		$h_G_PostInj = GUICtrlCreateGroup("Post injection", 15, 295, $l_GUIWidth / 3 - 25, 80, $SS_SUNKEN)
			GUICtrlSetFont($h_G_PostInj, 9, $FW_BOLD)

			GUIStartGroup()
				$h_C_Header = GUICtrlCreateCombo("", 20, 320, 93, -1, $CBS_DROPDOWNLIST)
					GUICtrlSetData($h_C_Header, "Keep PEH|Erase PEH|Fake PEH", "Keep PEH")
				If (BitAND($g_InjectionFlags, $INJ_ERASE_HEADER)) Then
					_GUICtrlComboBox_SetCurSel($h_C_Header, 1)
				ElseIf (BitAND($g_InjectionFlags, $INJ_FAKE_HEADER)) Then
					_GUICtrlComboBox_SetCurSel($h_C_Header, 2)
				EndIf

				$h_C_Unlink = GUICtrlCreateCheckbox("Unlink from PEB", 20, 345)
				If (BitAND($g_InjectionFlags, $INJ_UNLINK_FROM_PEB)) Then
					GUICtrlSetState($h_C_Unlink, $GUI_CHECKED)
				EndIf
				If ($g_InjectionMethod = 2) Then
					GUICtrlSetState($h_C_Unlink, BitOr($GUI_CHECKED, $GUI_DISABLE))
				EndIf

				$h_C_Shift 	= GUICtrlCreateCheckbox("Shift module", 125, 320)
				$h_C_Clean  = GUICtrlCreateCheckbox("Clean data directories", 125, 345)
				If ($g_InjectionMethod <> 2) Then
					GUICtrlSetState($h_C_Shift, $GUI_DISABLE)
					GUICtrlSetState($h_C_Clean, $GUI_DISABLE)
				Else
					If (BitAND($g_InjectionFlags, $INJ_SHIFT_MODULE)) Then
						GUICtrlSetState($h_C_Shift, $GUI_CHECKED)
					EndIf
					If (BitAND($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)) Then
						GUICtrlSetState($h_C_Clean, $GUI_CHECKED)
					EndIf
				EndIf

		$h_B_Reset = GUICtrlCreateButton("Reset", $l_GUIWidth / 24 + 3, $l_GUIHeight - 45, $l_GUIWidth / 4, 22)

	$h_L_Dlls = GUICtrlCreateListView("|Filename|Path|", $l_GUIWidth / 3 + 10, 95, 2 * $l_GUIWidth / 3 - 25, $l_GUIHeight - 200, $LVS_REPORT, BitOR($LVS_EX_FULLROWSELECT, $LVS_EX_CHECKBOXES))
		_GUICtrlListView_SetColumnWidth($h_L_Dlls, 0, 18)
		_GUICtrlListView_SetColumnWidth($h_L_Dlls, 1, 120)
		_GUICtrlListView_SetColumnWidth($h_L_Dlls, 2, 2 * $l_GUIWidth / 3 - 170)
		_GUICtrlListView_SetColumnWidth($h_L_Dlls, 3, 0)
		GUICtrlSetState($h_L_Dlls, $GUI_DROPACCEPTED)

	$h_G_DllList = GUICtrlCreateGroup("Files", $l_GUIWidth / 3 + 5, 80, 2 * $l_GUIWidth / 3 - 15, $l_GUIHeight - 145, $SS_SUNKEN)
		GUICtrlSetFont($h_G_DllList, 11, $FW_BOLD)

		$h_B_Add 	= GUICtrlCreateButton("Add files", $l_GUIWidth / 3 + 15, $l_GUIHeight - 95, $l_GUIWidth / 6, 22)
		$h_B_Inject = GUICtrlCreateButton("Inject", 2 * $l_GUIWidth / 3 - $l_GUIWidth / 12, $l_GUIHeight - 95, $l_GUIWidth / 6, 22)
		$h_B_Remove = GUICtrlCreateButton("Remove selected", $l_GUIWidth - $l_GUIWidth / 6 - 20, $l_GUIHeight - 95, $l_GUIWidth / 6, 22)

	$h_G_Info = GUICtrlCreateGroup("Info", $l_GUIWidth / 3 + 5, $l_GUIHeight - 62, 2 * $l_GUIWidth / 3 - 15, 47, $SS_SUNKEN)
		GUICtrlSetFont($h_G_Info, 11, $FW_BOLD)

		$h_L_Version = GUICtrlCreateLabel("Version " & $g_CurrentVersion, $l_GUIWidth / 3 + 15, $l_GUIHeight - 45, $l_GUIWidth / 8, 22, BitOR($SS_SUNKEN, $SS_CENTER))
			GUICtrlSetFont($h_L_Version, 12, $FW_BOLD)
			GUICtrlSetBkColor($h_L_Version, 0xCCCCAA)

			If (StringCompare($g_CurrentVersion, $g_NewestVersion) OR $g_IgnoreUpdates = True) Then
				GUICtrlSetColor($h_L_Version, 0xFF0000)
				GUICtrlSetCursor($h_L_Version, 0)
			Else
				GUICtrlSetColor($h_L_Version, 0x559955)
			EndIf

		$h_B_Help 		= GUICtrlCreateButton("Help", 37 * $l_GUIWidth / 72 + 10 / 3, $l_GUIHeight - 45, $l_GUIWidth / 8, 22)
		$h_B_Changelog 	= GUICtrlCreateButton("Changelog", 25 * $l_GUIWidth / 36 - 25 / 3, $l_GUIHeight - 45, $l_GUIWidth / 8, 22)
		$h_B_Broihon 	= GUICtrlCreateButton("Broihon", 7 * $l_GUIWidth / 8 - 20, $l_GUIHeight - 45, $l_GUIWidth / 8, 22)

	GUIRegisterMsg($WM_NOTIFY,	 	"WM_NOTIFY")
	GUIRegisterMsg($WM_DROPFILES, 	"WM_DROPFILES")
	GUIRegisterMsg($WM_COMMAND, 	"WM_COMMAND")

	GUISetState(@SW_SHOW, $h_GUI)

	Local $hDC = _WinAPI_GetDC($h_GUI)
	$BackgroundColour = _WinAPI_GetBkColor($hDC)
	_WinAPI_ReleaseDC($h_GUI, $hDC)
	_GUIImageList_Add($h_P_ProcIcon, _WinAPI_CreateSolidBitmap($h_GUI, $BackgroundColour, 21, 20))

EndFunc   ;==>CreateGUI

Func DllList_PopUp($hwnd)

	$idTog 	= 1
	$idAct	= 2
	$idDct	= 3
	$idDel	= 4
	$idOpen = 5

	$ItemHit = _GUICtrlListView_HitTest($hwnd)
	If (UBound($ItemHit) AND $ItemHit[0] <> -1) Then
		$h_M_PopUp = _GUICtrlMenu_CreatePopup()
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Toggle", $idTog)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Activate", $idAct)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Deactivate", $idDct)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Delete", $idDel)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Open", $idOpen)

		$selInd = _GUICtrlListView_GetSelectedIndices($h_L_Dlls, True)
		If ($selInd[0] = 0) Then
			_GUICtrlMenu_DestroyMenu($h_M_PopUp)
			Return
		EndIf

		Switch _GUICtrlMenu_TrackPopupMenu($h_M_PopUp, $hwnd, -1, -1, 1, 1, 2)
			Case $idTog
				For $i = 1 To $selInd[0] Step 1
					$state = _GUICtrlListView_GetItemChecked($h_L_Dlls, $selInd[$i])
					If ($state) Then
						$state = False
					Else
						$state = True
					EndIf
					_GUICtrlListView_SetItemChecked($h_L_Dlls, $selInd[$i], $state)
				Next

			Case $idAct
				For $i = 1 To $selInd[0] Step 1
					_GUICtrlListView_SetItemChecked($h_L_Dlls, $selInd[$i])
				Next

			Case $idDct
				For $i = 1 To $selInd[0] Step 1
					_GUICtrlListView_SetItemChecked($h_L_Dlls, $selInd[$i], False)
				Next

			Case $idDel
				For $i = 1 To $selInd[0] Step 1
					_GUICtrlListView_DeleteItem($h_L_Dlls, $selInd[$i])
					For $j = $i To $selInd[0] Step 1
						$selInd[$j] -= 1
					Next
				Next

			Case $idOpen
				$filepath = _GUICtrlListView_GetItemText($h_L_Dlls, $ItemHit[0], 2)
				$index = StringInStr($filepath, "\", 0, -1)
				$filepath = StringTrimRight($filepath, StringLen($filepath) - $index)
				AddFiles($filepath)

		EndSwitch

		_GUICtrlMenu_DestroyMenu($h_M_PopUp)
	Else
		$h_M_PopUp = _GUICtrlMenu_CreatePopup()
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Toggle all", $idTog)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Activate all", $idAct)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Deactivate all", $idDct)
			_GUICtrlMenu_AddMenuItem($h_M_PopUp, "Delete all", $idDel)

		Switch _GUICtrlMenu_TrackPopupMenu($h_M_PopUp, $hwnd, -1, -1, 1, 1, 2)
			Case $idTog
				$count = _GUICtrlListView_GetItemCount($h_L_Dlls)
				For $i = 0 To $count - 1 Step 1
					$state = _GUICtrlListView_GetItemChecked($h_L_Dlls, $i)
					If ($state) Then
						$state = False
					Else
						$state = True
					EndIf
					_GUICtrlListView_SetItemChecked($h_L_Dlls, $i, $state)
				Next

			Case $idAct
				$count = _GUICtrlListView_GetItemCount($h_L_Dlls)
				For $i = 0 To $count - 1 Step 1
					_GUICtrlListView_SetItemChecked($h_L_Dlls, $i)
				Next

			Case $idDct
				$count = _GUICtrlListView_GetItemCount($h_L_Dlls)
				For $i = 0 To $count - 1 Step 1
					_GUICtrlListView_SetItemChecked($h_L_Dlls, $i, False)
				Next

			Case $idDel
				_GUICtrlListView_DeleteAllItems($h_L_Dlls)

		EndSwitch

		_GUICtrlMenu_DestroyMenu($h_M_PopUp)
	EndIf

EndFunc   ;==>DllList_PopUp

Func WM_NOTFIY_GUI($hwnd, $uMsg, $wParam, $lParam)

	$tNMHDR = DllStructCreate($tagNMHDR, $lParam)

	$hListView = $h_L_Dlls
	If (NOT IsHWnd($hListView)) Then
		$hListView = GUICtrlGetHandle($h_L_Dlls)
	EndIf

	If (HWnd($tNMHDR.hwndFrom) = $hListView) Then
		If ($tNMHDR.code = $NM_RCLICK) Then
			DllList_PopUp($hListView)
			Return 0

		ElseIf ($tNMHDR.code = $NM_CUSTOMDRAW) Then
			If (_GUICtrlListView_GetColumnWidth($h_L_Dlls, 3) <> 0) Then
				_GUICtrlListView_SetColumnWidth($h_L_Dlls, 3, 0)
			EndIf
			Return 0

		ElseIf ($tNMHDR.code = $NM_DBLCLK) Then
			$tInfo = DllStructCreate($tagNMITEMACTIVATE, $lParam)
			If ($tInfo.SubItem > 0) Then
				$l_DoubleClickedDll = $tInfo.Index
			EndIf
			Return 0

		EndIf
	EndIf

    Return $GUI_RUNDEFMSG

EndFunc

Func WM_NOTIFY($hwnd, $uMsg, $wParam, $lParam)

	If (NOT $l_ProcessPickerActive) Then
		Return WM_NOTFIY_GUI($hwnd, $uMsg, $wParam, $lParam)
	Else
		Return WM_NOTIFY_ProcessPicker($hwnd, $uMsg, $wParam, $lParam)
	EndIf

EndFunc   ;==>WM_NOTFIY

Func WM_DROPFILES($hwnd, $uMsg, $wParam, $lParam)

    Local $Ret = _WinAPI_DragQueryFileEx($wParam, 1)
	If UBound($Ret) Then
		$DropFileBuffer = $Ret
	Else
		$DropFileBuffer[0] = 0
	EndIf

    Return $GUI_RUNDEFMSG

EndFunc   ;==>WM_DROPFILES

Func WM_COMMAND($hwnd, $uMsg, $wParam, $lParam)

    Local $NotifyCode = _WinAPI_HiWord($wParam)

    If ($NotifyCode = $EN_CHANGE) Then
		Local $NotifierID = _WinAPI_LoWord($wParam)

		If ($NotifierID = $h_I_ProcName AND NOT $l_IgnoreInputChange) Then
			$g_Processname = GUICtrlRead($h_I_ProcName)
			$l_UpdateProcess = True

		ElseIf ($NotifierID = $h_I_PID AND NOT $l_IgnoreInputChange) Then
			$g_PID = GUICtrlRead($h_I_PID)
			$l_UpdateProcess = True

		ElseIf ($NotifierID = $h_I_InjDelay AND NOT $l_IgnoreInputChange) Then
			$g_InjectionDelay = GUICtrlRead($h_I_InjDelay)
		EndIf

		Return 0
	EndIf

    Return $GUI_RUNDEFMSG

EndFunc   ;==>WM_COMMAND

Func ResetGUI()

		GUICtrlSetState($h_R_ProcName, $GUI_CHECKED)
		GUICtrlSetState($h_I_PID, $GUI_DISABLE)

		GUICtrlSetData($h_I_ProcName, $g_Processname)
		GUICtrlSetData($h_I_PID, $g_PID)

		GUICtrlSetData($h_I_InjDelay, $g_InjectionDelay)

		If ($g_CloseAfterInjection) Then
			GUICtrlSetState($h_C_CloseAI, $GUI_CHECKED)
		Else
			GUICtrlSetState($h_C_CloseAI, $GUI_UNCHECKED)
		EndIf

		If ($g_AutoInjection) Then
			GUICtrlSetState($h_C_AutoI, $GUI_CHECKED)
		Else
			GUICtrlSetState($h_C_AutoI, $GUI_UNCHECKED)
		EndIf

		If NOT ($g_InjectionMethod) Then
			GUICtrlSetState($h_R_LoadLib, $GUI_CHECKED)
		ElseIf ($g_InjectionMethod = 1) Then
			GUICtrlSetState($h_R_LdrDll, $GUI_CHECKED)
		ElseIf ($g_InjectionMethod = 2) Then
			GUICtrlSetState($h_R_MMap, $GUI_CHECKED)
		EndIf

		_GUICtrlComboBox_SetCurSel($h_C_LaunchMethod, $g_LaunchMethod)

		If ($g_LaunchMethod = 0) Then
			If (BitAND($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)) Then
				GUICtrlSetState($h_C_HTFD, BitOR($GUI_UNCHECKED, $GUI_ENABLE))
			Else
				GUICtrlSetState($h_C_HTFD, BitOR($GUI_UNCHECKED, $GUI_ENABLE))
			EndIf
		Else
			GUICtrlSetState($h_C_HTFD, BitOR($GUI_UNCHECKED, $GUI_DISABLE))
		EndIf

		_GUICtrlComboBox_SetCurSel($h_C_Header, 0)
		If (BitAND($g_InjectionFlags, $INJ_ERASE_HEADER)) Then
			_GUICtrlComboBox_SetCurSel($h_C_Header, 1)
		ElseIf (BitAND($g_InjectionFlags, $INJ_ERASE_HEADER)) Then
			_GUICtrlComboBox_SetCurSel($h_C_Header, 2)
		EndIf

		If (BitAND($g_InjectionFlags, $INJ_UNLINK_FROM_PEB)) Then
			GUICtrlSetState($h_C_Unlink, $GUI_CHECKED)
		Else
			GUICtrlSetState($h_C_Unlink, $GUI_UNCHECKED)
		EndIf


		If ($g_InjectionMethod <> 2) Then
			GUICtrlSetState($h_C_Shift, $GUI_DISABLE)
			GUICtrlSetState($h_C_Clean, $GUI_DISABLE)
		Else
			If (BitAND($g_InjectionFlags, $INJ_SHIFT_MODULE)) Then
				GUICtrlSetState($h_C_Shift, $GUI_CHECKED)
			EndIf
			If (BitAND($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)) Then
				GUICtrlSetState($h_C_Clean, $GUI_CHECKED)
			EndIf
		EndIf

		_GUICtrlListView_DeleteAllItems($h_L_Dlls)

EndFunc   ;==>ResetGUI

Func CloseGUI()

	GUIRegisterMsg($WM_NOTIFY,		"")
	GUIRegisterMsg($WM_DROPFILES, 	"")
	GUIRegisterMsg($WM_COMMAND, 	"")

	_GUIImageList_Destroy($h_P_ProcIcon)

	GUISetState(@SW_HIDE)
	GUIDelete($h_GUI)

EndFunc   ;==>CloseGUI

Func CheckBanner()

	Local $CursorInfo = GUIGetCursorInfo($h_GUI)

	If (NOT @error) Then
		If (WinActive($h_GUI) AND $CursorInfo[0] >= 0 AND $CursorInfo[0] <= $l_GUIWidth AND $CursorInfo[1] >= 0 AND $CursorInfo[1] <= $l_BannerHeight AND $CursorInfo[4] = $h_P_Banner) Then
			$l_HoverBanner = True
		Else
			$l_HoverBanner = False
		EndIf
		If (WinActive($h_GUI) AND $CursorInfo[0] >= 130 AND $CursorInfo[0] <= 151 AND $CursorInfo[1] >= 132 AND $CursorInfo[1] <= 152) Then
			$l_HoverProcIcon = True
		Else
			$l_HoverProcIcon = False
		EndIf
	EndIf

	If ($l_HoverProcIcon <> $l_HoverProcIconPrev) Then
		If ($l_HoverProcIcon = True) Then
			Local $CursorPos = MouseGetPos()
			ToolTip($g_ExePath, $CursorPos[0], $CursorPos[1])
		Else
			ToolTip("")
		EndIf
		$l_HoverProcIconPrev = $l_HoverProcIcon
	EndIf

	If ($l_HoverBanner <> $l_HoverBannerPrev) Then
		If ($l_HoverBanner = True) Then
			Local $CursorPos = MouseGetPos()
			ToolTip("www.guidedhacking.com", $CursorPos[0], $CursorPos[1])
		Else
			ToolTip("")
		EndIf
		$l_HoverBannerPrev = $l_HoverBanner
	EndIf

EndFunc   ;==>CheckBanner

Func AddFile($Path, $UpdateLastDirectory = False)

	If (NOT StringInStr($Path, ".dll")) Then
		Return
	EndIf

	Local $Split = StringSplit($Path, "\")
	$Index = _GUICtrlListView_AddItem($h_L_Dlls, "")
	_GUICtrlListView_AddSubItem($h_L_Dlls, $Index, $Split[$Split[0]], 1)
	_GUICtrlListView_AddSubItem($h_L_Dlls, $Index, $Path, 2)
	_GUICtrlListView_AddSubItem($h_L_Dlls, $Index, 0, 3)

	If ($UpdateLastDirectory = True) Then
		$g_LastDirectory = ""
		For $i = 0 To $Split[0] - 2 Step 1
			$g_LastDirectory = $g_LastDirectory & $Split[$i + 1] & "\"
		Next
	EndIf

EndFunc   ;==>AddFile

Func AddFiles($Path = "")

	If (NOT StringCompare($Path, "")) Then
		$Path = $g_LastDirectory
	EndIf

	$Files = FileOpenDialog("Select dll files", $Path, "Dynamic Link Libraries (*.dll)", $FD_MULTISELECT)
	If (@error) Then
		Return
	EndIf

	Local $Chars = StringSplit($Files, "|")
	If (@error = 1) Then
		AddFile($Files, True)
		Return
	EndIf

	For $i = 2 To $Chars[0] Step 1
		AddFile($Chars[1] & "\" & $Chars[$i])
	Next

	$g_LastDirectory = $Chars[1]

EndFunc   ;==>AddFiles

Func RemoveSelectedFiles()

	$selInd = _GUICtrlListView_GetSelectedIndices($h_L_Dlls, True)
	If ($selInd[0] = 0) Then
		Return
	EndIf

	For $i = 1 To $selInd[0] Step 1
		_GUICtrlListView_DeleteItem($h_L_Dlls, $selInd[$i])
		For $j = $i To $selInd[0] Step 1
			$selInd[$j] -= 1
		Next
	Next

EndFunc   ;==>RemoveSelectedFiles

Func UpdateProcessIcon($TargetPID)

	If ($TargetPID) Then
		Local $hK32 = DllOpen("kernel32.dll")
		$hProc_info = DllCall($hK32, "HANDLE", "OpenProcess", _
			"DWORD", $PROCESS_QUERY_LIMITED_INFORMATION, _
			"INT", 0, _
			"DWORD", $TargetPID _
		)

		If (IsArray($hProc_info) AND $hProc_info[0]) Then

			Local $dllRet = GetProcessExePath($hProc_info)
			If (IsArray($dllRet) AND ($dllRet[0] <> 0)) Then
				$l_ProcIconIndex = 3
				_GUIImageList_Remove($h_P_ProcIcon, 3)
				$g_ExePath = $dllRet[3]
				If (_GUIImageList_AddIcon($h_P_ProcIcon, $dllRet[3], 0) = -1) Then
					$l_ProcIconIndex = 1
				EndIf
			EndIf

			DllCall($hK32, "BOOL", "CloseHandle", _
				"HANDLE", $hProc_info[0] _
			)

		Else
			$l_ProcIconIndex = 1
			$g_ExePath = "Can't resolve file path."
		EndIf

		_GUIImageList_Draw($h_P_ProcIcon, 2, _WinAPI_GetDC($h_GUI), 130, 132)
		_GUIImageList_Draw($h_P_ProcIcon, $l_ProcIconIndex, _WinAPI_GetDC($h_GUI), 130, 132)

		DllClose($hK32)

	Else
		$l_ProcIconIndex = 0
		$g_ExePath = "No process selected."
		_GUIImageList_Draw($h_P_ProcIcon, 2, _WinAPI_GetDC($h_GUI), 130, 132)
		_GUIImageList_Draw($h_P_ProcIcon, $l_ProcIconIndex, _WinAPI_GetDC($h_GUI), 130, 132)
	EndIf

EndFunc   ;==>UpdateProcessIcon

Func UpdateTargetProcess()

	$l_IgnoreInputChange = True

	If ($g_ProcessByName) Then
		$g_Processname = GUICtrlRead($h_I_ProcName)
		$lPID1 = ProcessExists($g_Processname)
		$lPID2 = ProcessExists($g_PID)

		If ($lPID1) Then
			If ($lPID2) Then
				If ($lPID1 <> $lPID2) Then
					If (NOT StringCompare($g_Processname, _ProcessGetName($lPID2))) Then
						$g_PID = $lPID2
					Else
						$g_PID = $lPID1
					EndIf
				EndIf
			Else
				$g_PID = $lPID1
			EndIf
		Else
			$g_PID = 0
		EndIf

		GUICtrlSetData($h_I_PID, $g_PID)
	Else
		$g_PID = GUICtrlRead($h_I_PID)
		$g_Processname = _ProcessGetName($g_PID)

		If (@error) Then
			GUICtrlSetFont($h_I_ProcName, 9, $FW_LIGHT, $GUI_FONTITALIC)
			$g_Processname = "Invalid PID"
		Else
			GUICtrlSetFont($h_I_ProcName, 9)
		EndIf

		GUICtrlSetData($h_I_ProcName, $g_Processname)
	EndIf

	UpdateProcessIcon(ProcessExists($g_PID))

	$l_ProcessDead = False

	$l_IgnoreInputChange = False

EndFunc   ;==>UpdateTargetProcess

Func UpdateGUI()

	If ($l_DoubleClickedDll <> -1) Then
		$filepath 	= _GUICtrlListView_GetItemText($h_L_Dlls, $l_DoubleClickedDll, 2)
		$index 		= StringInStr($filepath, "\", 0, -1)
		$filepath 	= StringTrimRight($filepath, StringLen($filepath) - $index)
		AddFiles($filepath)
		$l_DoubleClickedDll = -1
	EndIf

	$Msg = GUIGetMsg($h_GUI)
	Select
		Case $Msg = $GUI_EVENT_CLOSE
			Return $GUI_EXIT

		Case $Msg = $h_P_Banner
			ShellExecute("www.guidedhacking.com")

		Case $Msg = $h_B_SelProcess
			$l_ProcessPickerActive 	= True
			$l_IgnoreInputChange 	= True

			$newPID = CreateProcessList()
			If ($newPID <> -1) Then
				$g_PID = $newPID
				GUICtrlSetData($h_I_PID, $g_PID)
				$g_Processname = _ProcessGetName($g_PID)
				GUICtrlSetData($h_I_ProcName, $g_Processname)
				UpdateProcessIcon($g_PID)
			EndIf

			$l_IgnoreInputChange 	= False
			$l_ProcessPickerActive 	= False

		Case $Msg = $h_B_Add
			AddFiles()

		Case $Msg = $h_B_Remove
			RemoveSelectedFiles()

		Case $Msg = $GUI_EVENT_DROPPED
			If ($DropFileBuffer[0]) Then
				For $i = 1 To $DropFileBuffer[0]
					AddFile($DropFileBuffer[$i])
				Next
			EndIf

		Case $Msg = $h_L_Dlls

			$State = GUICtrlGetState($h_L_Dlls)

			If ($State = 0) Then
				$count = _GUICtrlListView_GetItemCount($h_L_Dlls)
				For $i = 0 To $count - 1 Step 1
					$state = _GUICtrlListView_GetItemChecked($h_L_Dlls, $i)
					_GUICtrlListView_SetItemText($h_L_Dlls, $i, Number($state), 3)
				Next
				_GUICtrlListView_SimpleSort($h_L_Dlls, $g_DllList_SortSense, 3, True)

			ElseIf ($State = 1) Then
				_GUICtrlListView_SimpleSort($h_L_Dlls, $g_DllList_SortSense, 1, True)

			ElseIf ($State = 2) Then
				_GUICtrlListView_SimpleSort($h_L_Dlls, $g_DllList_SortSense, 2, True)
			EndIf

		Case $Msg = $h_B_Reset
			Return $GUI_RESET

		Case $Msg = $h_R_ProcName
			If ((GUICtrlRead($h_R_ProcName) = $GUI_CHECKED) AND  (GUICtrlGetState($h_I_PID) <> $GUI_DISABLE)) Then
				GUICtrlSetState($h_I_PID, $GUI_DISABLE)
				GUICtrlSetState($h_I_ProcName, $GUI_ENABLE)
				$g_ProcessByName = True
			EndIf

			$l_UpdateProcess = True

		Case $Msg = $h_R_PID
			If ((GUICtrlRead($h_R_PID) = $GUI_CHECKED) AND  (GUICtrlGetState($h_I_ProcName) <> $GUI_DISABLE)) Then
				GUICtrlSetState($h_I_ProcName, $GUI_DISABLE)
				GUICtrlSetState($h_I_PID, $GUI_ENABLE)
				$g_ProcessByName = False
			EndIf

			$l_UpdateProcess = True

		Case $Msg = $h_C_CloseAI
			If (GUICtrlRead($h_C_CloseAI) = $GUI_CHECKED) Then
				$g_CloseAfterInjection = True
			Else
				$g_CloseAfterInjection = False
			EndIf

		Case $Msg = $h_C_AutoI
			If (GUICtrlRead($h_C_AutoI) = $GUI_CHECKED) Then
				$g_AutoInjection = True
			Else
				$g_AutoInjection = False
			EndIf

		Case $Msg = $h_R_LoadLib
			If (GUICtrlRead($h_R_LoadLib) = $GUI_CHECKED) Then
				$g_InjectionMethod = 0
				If (GUICtrlGetState($h_C_Shift) <> $GUI_DISABLE) Then
					GUICtrlSetState($h_C_Unlink, $GUI_ENABLE)
					GUICtrlSetState($h_C_Shift, BitOR($GUI_DISABLE, $GUI_UNCHECKED))
					GUICtrlSetState($h_C_Clean, BitOR($GUI_DISABLE, $GUI_UNCHECKED))

					If (BitAND($g_InjectionFlags, $INJ_SHIFT_MODULE)) Then
						$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_SHIFT_MODULE)
					EndIf
					If (BitAND($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)) Then
						$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)
					EndIf
				EndIf
			EndIf

		Case $Msg = $h_R_LdrDll
			If (GUICtrlRead($h_R_LdrDll) = $GUI_CHECKED) Then
				$g_InjectionMethod = 1
				If (GUICtrlGetState($h_C_Shift) <> $GUI_DISABLE) Then
					GUICtrlSetState($h_C_Unlink, $GUI_ENABLE)
					GUICtrlSetState($h_C_Shift, BitOR($GUI_DISABLE, $GUI_UNCHECKED))
					GUICtrlSetState($h_C_Clean, BitOR($GUI_DISABLE, $GUI_UNCHECKED))

					If (BitAND($g_InjectionFlags, $INJ_SHIFT_MODULE)) Then
						$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_SHIFT_MODULE)
					EndIf
					If (BitAND($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)) Then
						$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)
					EndIf
				EndIf
			EndIf

		Case $Msg = $h_R_MMap
			If (GUICtrlRead($h_R_MMap) = $GUI_CHECKED) Then
				$g_InjectionMethod = 2
				If (GUICtrlGetState($h_C_Shift) <> $GUI_ENABLE) Then
					GUICtrlSetState($h_C_Shift, $GUI_ENABLE)
					GUICtrlSetState($h_C_Clean, $GUI_ENABLE)
					GUICtrlSetState($h_C_Unlink, BitOR($GUI_CHECKED, $GUI_DISABLE))
					$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_UNLINK_FROM_PEB)
				EndIf
			EndIf

		Case $Msg = $h_C_LaunchMethod
			$g_LaunchMethod = _GUICtrlComboBox_GetCurSel($h_C_LaunchMethod)
			If (($g_LaunchMethod) AND (BitAND(GUICtrlGetState($h_C_HTFD), $GUI_ENABLE))) Then
				GUICtrlSetState($h_C_HTFD, BitOR($GUI_UNCHECKED, $GUI_DISABLE))
				If (BitAND($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)) Then
					$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)
				EndIf
			ElseIf (($g_LaunchMethod = 0) AND (BitAND(GUICtrlGetState($h_C_HTFD), $GUI_DISABLE))) Then
				GUICtrlSetState($h_C_HTFD, $GUI_ENABLE)
			EndIf

		Case $Msg = $h_C_HTFD
			If (GUICtrlRead($h_C_HTFD) = $GUI_CHECKED) Then
				$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)
			ElseIf (BitAND($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)) Then
				$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_HIDE_THREAD_FROM_DEBUGGER)
			EndIf

		Case $Msg = $h_C_Header
			$HeaderOption = _GUICtrlComboBox_GetCurSel($h_C_Header)
			If (BitAND($g_InjectionFlags, $INJ_ERASE_HEADER)) Then
				$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_ERASE_HEADER)
			EndIf
			If (BitAND($g_InjectionFlags, $INJ_FAKE_HEADER)) Then
				$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_FAKE_HEADER)
			EndIf

			If ($HeaderOption = 1) Then
				$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_ERASE_HEADER)
			ElseIf ($HeaderOption = 2) Then
				$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_FAKE_HEADER)
			EndIf

		Case $Msg = $h_C_Unlink
			If (GUICtrlRead($h_C_Unlink) = $GUI_CHECKED) Then
				$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_UNLINK_FROM_PEB)
			Else
				If (BitAND($g_InjectionFlags, $INJ_UNLINK_FROM_PEB)) Then
					$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_UNLINK_FROM_PEB)
				EndIf
			EndIf

		Case $Msg = $h_C_Shift
			If (GUICtrlRead($h_C_Shift) = $GUI_CHECKED) Then
				$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_SHIFT_MODULE)
			Else
				If (BitAND($g_InjectionFlags, $INJ_SHIFT_MODULE)) Then
					$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_SHIFT_MODULE)
				EndIf
			EndIf

		Case $Msg = $h_C_Clean
			If (GUICtrlRead($h_C_Clean) = $GUI_CHECKED) Then
				$g_InjectionFlags = BitOR($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)
			Else
				If (BitAND($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)) Then
					$g_InjectionFlags = BitXOR($g_InjectionFlags, $INJ_CLEAN_DATA_DIR)
				EndIf
			EndIf

		Case $Msg = $h_B_Inject
			Return $GUI_INJECT

		Case $Msg = $h_L_Version
			Return $GUI_UPDATE

		Case $Msg = $h_B_Help
			ShellExecute("https://www.guidedhacking.com/ghinjector")

		Case $Msg = $h_B_Changelog
			ShellExecute("https://www.pastebin.com/eN7KPX3x")

		Case $Msg = $h_B_Broihon
			ShellExecute("https://i.gyazo.com/41f5d38c561eabb4d44eec1606b2cadb.jpg")

	EndSelect

	If ($g_ProcessByName AND ProcessExists($g_Processname) AND NOT ProcessExists($g_PID)) Then
		UpdateTargetProcess()
	ElseIf(NOT $g_ProcessByName AND NOT $l_UpdateProcess AND ProcessExists($g_Processname) AND NOT ProcessExists($g_PID)) Then
		$g_ProcessByName = True
		UpdateTargetProcess()
		$g_ProcessByName = False
	ElseIf(NOT ProcessExists($g_Processname) AND NOT ProcessExists($g_PID) AND NOT $l_ProcessDead) Then
		UpdateProcessIcon(0)
		$l_ProcessDead = True
	EndIf


	If ($l_UpdateProcess) Then
		UpdateTargetProcess()
		$l_UpdateProcess = False
	EndIf

	CheckBanner()

	Return $GUI_RETURN

EndFunc   ;==>UpdateGUI